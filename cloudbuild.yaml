steps:
  # Step 1: Clone the Git repository
  - name: 'gcr.io/cloud-builders/git'
    args: ['clone', 'https://github.com/nishyman10/Demo.Test.git', 'source']
    
  # Step 2: Additional build steps
  - name: 'gcr.io/cloud-builders/docker'
    args: ['build', '-t', 'gcr.io/$PROJECT_ID/mvn', 'source']
  
  # Step 3: Install SonarScanner CLI
  - name: 'openjdk:11'
    entrypoint: 'bash'
    args:
      - '-c'
      - |
        apt-get update && apt-get install -y unzip
        curl -LsS -o sonar-scanner.zip https://binaries.sonarsource.com/Distribution/sonar-scanner-cli/sonar-scanner-cli-4.6.2.2472-linux.zip
        unzip sonar-scanner.zip && rm sonar-scanner.zip
        export SONAR_SCANNER_HOME=$PWD/sonar-scanner-4.6.2.2472-linux
        export PATH=$SONAR_SCANNER_HOME/bin:$PATH
        apt-get install -y maven
  
  # Step 4: Scan the source code using SonarScanner CLI
  - name: 'openjdk:11'
    entrypoint: 'bash'
    args:
      - '-c'
      - |
        sonar-scanner \
        -Dsonar.host.url=https://sonarcloud.io \
        -Dsonar.login=30d7ea8abc8f6da04194590366dffd73cbec51f2 \
        -Dsonar.projectKey=nishyman10_Demo.Test \
        -Dsonar.sources=source \
        -Dsonar.java.binaries=source/target/classes
